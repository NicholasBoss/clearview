<% if (title) { %>
    <h1><%= title %></h1>
<% } else { res.redirect('/') } %>

<div class="rainier-notice">
    <strong>Note:</strong> All fields are required unless otherwise noted.
</div>

<%- messages() %>

<% if (errors) { %>
    <div class="error-banner">
        <h3>Please correct the following errors:</h3>
        <ul>
            <% errors.array().forEach(error => { %>
                <li><%= error.msg %></li>
            <% }) %>
        </ul>
    </div>
<% } %>

<form id="form" action="/orders/confirmRainier" method="post">
    <div class="container">
        <label class="required-field"><b>Customer First Name</b>
            <input type="text" name="customer_firstname" id="customer_firstname" value="<%= formData.customer_firstname || '' %>" placeholder="Enter customer first name" required <%= errors && errors.array().find(e => e.path === 'customer_firstname') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'customer_firstname'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Customer Last Name</b>
            <input type="text" name="customer_lastname" id="customer_lastname" value="<%= formData.customer_lastname || '' %>" placeholder="Enter customer last name" required <%= errors && errors.array().find(e => e.path === 'customer_lastname') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'customer_lastname'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Placement</b>
            <select name="rainier_placement" id="rainier_placement" required <%= errors && errors.array().find(e => e.path === 'rainier_placement') ? 'class="error-input"' : '' %>>
                <option value="">Select Placement</option>
                <% if (placement && placement.length > 0) { %>
                    <% placement.forEach(function(item) { %>
                        <option value="<%= item.placement_name %>" <%= formData.rainier_placement === item.placement_name ? 'selected' : '' %>><%= item.placement_name %></option>
                    <% }); %>
                <% } %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'rainier_placement'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Hardware Color</b>
            <select name="rainier_color" id="">
                <option value="">Select</option>
                <% colors.forEach(item => { %>
                    <option value="<%= item.color_name %>"><%= item.color_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'hardware_color'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Fabric & Color</b>
            <select name="fabric_color" id="fabric_color" required <%= errors && errors.array().find(e => e.path === 'fabric_color') ? 'class="error-input"' : '' %>>
                <option value="">Select Fabric & Color</option>
                <% if (rainierFabricColors && rainierFabricColors.length > 0) { %>
                    <% rainierFabricColors.forEach(function(item) { %>
                        <option value="<%= item.fabric_name %>" <%= formData.fabric_color === item.fabric_name ? 'selected' : '' %>><%= item.fabric_name %></option>
                    <% }); %>
                <% } %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'fabric_color'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Housing Series</b>
            <select name="housing_series" id="">
                <option value="">Select</option>
                <% housing.forEach(item => { %>
                    <option value="<%= item.housing_series_name %>"><%= item.housing_series_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'housing_series'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Drive Side</b>
            <select name="drive_side" id="">
                <option value="">Select</option>
                <% driveSide.forEach(item => { %>
                    <option value="<%= item.drive_side_name %>"><%= item.drive_side_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'drive_side'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Hembar</b>
            <select name="hembar_name" id="">
                <option value="">Select</option>
                <% hembar.forEach(item => { %>
                    <option value="<%= item.hembar_name %>"><%= item.hembar_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'hembar_name'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Pile Brush</b> 
            <select name="pile_brush" id="">
                <option value="">Select</option>
                <% pilebrush.forEach(item => { %>
                    <option value="<%= item.pilebrush_name %>"><%= item.pilebrush_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'pile_brush'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Brush Location</b>
            <select name="brush_location" id="">
                <option value="">Select</option>
                <% brushLocation.forEach(item => { %>
                    <option value="<%= item.brush_location_name %>"><%= item.brush_location_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'brush_location'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Zipper Color</b>
            <select name="zipper_color" id="">
                <option value="">Select</option>
                <% zipperColor.forEach(item => { %>
                    <option value="<%= item.color_name %>"><%= item.color_name%></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'zipper_color'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Cord Length</b>
            <select name="cord_length" id="">
                <option value="">Select</option>
                <% cordLength.forEach(item => { %>
                    <option value="<%= item.cord_length_name %>"><%= item.cord_length_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'cord_length'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Mount Type</b>
            <select name="mount_type" id="mount_type_id">
                <option value="">Select</option>
                <% mountTypes.forEach(item => { %>
                    <option value="<%= item.mount_type_name %>"><%= item.mount_type_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'mount_type'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Top Opening Width</b>
            <input type="text" name="top_opening_width" id="">
        </label><br>
        <label><b>Top Opening Width Inch</b>
            <select name="top_opening_width_inch" id="top_opening_width_id">
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>"><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_opening_width'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Top Level</b>
            <input type="text" name="top_level" id="">
        </label><br>
        <label><b>Bottom Opening Width</b>
            <input type="text" name="bottom_opening_width" id="bottom_opening_width_id">
        </label><br>
        <label><b>Bottom Opening Width Inch</b>
            <select name="bottom_opening_width_inch" id="">
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                <option value="<%= fraction.measurement_name %>"><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_opening_width_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Bottom Level</b>
            <input type="text" name="bottom_level" id="">
        </label><br>
        <label><b>Left Opening Height</b>
            <input type="text" name="left_opening_height" id="">
        </label><br>
        <label><b>Left Opening Height Inch</b>
            <select name="left_opening_height_inch" id="">
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                <option value="<%= fraction.measurement_name %>"><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_level'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Left Plumb</b>
            <input type="text" name="left_plumb" id="">
        </label><br>
        <label><b>Right Opening Height</b>
            <input type="text" name="right_opening_height" id="">
        </label><br>
        <label><b>Right Opening Height Inch</b>
            <select name="right_opening_height_inch" id="">
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>"><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'bottom_opening_width'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Right Plumb</b>
            <input type="text" name="right_plumb" id="">
        </label><br>
        <label><b>Left Build Out</b>
            <select name="left_build_out" id="">
                <option value="None">Select</option>
                <% leftBuildout.forEach(item => { %>
                    <option value="<%= item.left_buildout_name %>"><%= item.left_buildout_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'bottom_opening_width_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Right Build Out</b>
            <select name="right_build_out" id="">
                <option value="None">Select</option>
                <% rightBuildout.forEach(item => { %>
                    <option value="<%= item.right_buildout_name %>"><%= item.right_buildout_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'bottom_level'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Add Build Out</b>
            <input type="text" name="add_build_out" id="">
        </label><br>
        <label><b>Left Track</b>
            <select name="left_track" id="">
                <option value="None">Select</option>
                <% leftTrack.forEach(item => { %>
                    <option value="<%= item.left_track_name %>"><%= item.left_track_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'left_opening_height'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label><b>Right Track</b>
            <select name="right_track" id="">
                <option value="None">Select</option>
                <% rightTrack.forEach(item => { %>
                    <option value="<%= item.right_track_name %>"><%= item.right_track_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'left_opening_height_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        
        <div class="form-actions">
            <a href="/account" class="btn-back">‚Üê Back to Account</a>
        </div>
    </div>
</form>

<script>
    // Make all form elements readonly for view mode
    document.addEventListener('DOMContentLoaded', function() {
        // Disable all select elements
        document.querySelectorAll('select').forEach(select => {
            select.disabled = true;
        });

        // Disable all input elements (that aren't already readonly)
        document.querySelectorAll('input').forEach(input => {
            input.readOnly = true;
        });

        // Prevent form submission
        document.getElementById('form').addEventListener('submit', function(event) {
            event.preventDefault();
        });
    });
</script>

<style>
    .btn-back {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        background-color: #6c757d;
        color: white;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.2s;
    }

    .btn-back:hover {
        background-color: #5a6268;
    }

    select:disabled, input[readonly] {
        background-color: #e9ecef;
        cursor: not-allowed;
    }
</style>