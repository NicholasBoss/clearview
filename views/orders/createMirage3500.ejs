<!-- The following fields remain hardcoded as they don't appear to have dedicated database tables:
  - Mohair options
  - Mohair Position
  - Mohair Size
  - Markup Multiplier -->


<% if (title) { %>
    <h1>
        <%= title %>
    </h1>
    <% } else { res.redirect('/') } %>
        <div class="mirage-notice">
            <strong>Note:</strong> All fields are required unless otherwise noted.
        </div>
        <%- messages() %>
        <% if (errors) { %>
            <div class="error-banner">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
                </svg>
                <div>
                    <strong>Submission Error</strong>
                    <p>There are errors with your submission. Please review the form and correct the highlighted fields.</p>
                </div>
            </div>
            <% } %>


<form id="form" action="/orders/confirmMirage3500" method="post">
    <div class="container">
        <label class="required-field"><b>Top Opening Width</b>
            <input type="text" name="top_opening_width" id="top_opening_width" value="<%= formData.top_opening_width || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'top_opening_width') ? 'class="error-input"' : '' %>>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'top_opening_width') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>
        <label class="required-field"><b>Top Opening Width Fraction</b>
            <select name="top_opening_width_fraction" id="top_opening_width_fraction" required <%= errors && errors.array().find(e => e.path === 'top_opening_width_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name%>" <%= formData.top_opening_width_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'top_opening_width_fraction') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

        <label class="required-field"><b>Middle Opening Width</b>
            <input type="text" name="middle_opening_width" id="middle_opening_width" value="<%= formData.middle_opening_width || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'middle_opening_width') ? 'class="error-input"' : '' %>>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'middle_opening_width') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>
        <label class="required-field"><b>Middle Opening Width Fraction</b>
            <select name="middle_opening_width_fraction" id="middle_opening_width_fraction" required <%= errors && errors.array().find(e => e.path === 'middle_opening_width_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.middle_opening_width_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'middle_opening_width_fraction') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

        <label class="required-field"><b>Bottom Opening Width</b>
            <input type="text" name="bottom_opening_width" id="bottom_opening_width" value="<%= formData.bottom_opening_width || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'bottom_opening_width') ? 'class="error-input"' : '' %>>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'bottom_opening_width') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>
        <label class="required-field"><b>Bottom Opening Width Fraction</b>
            <select name="bottom_opening_width_fraction" id="bottom_opening_width_fraction" required <%= errors && errors.array().find(e => e.path === 'bottom_opening_width_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.bottom_opening_width_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'bottom_opening_width_fraction') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

        <label class="required-field"><b>Left Opening Height</b>
            <input type="text" name="left_opening_height" id="left_opening_height" value="<%= formData.left_opening_height || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'left_opening_height') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'left_opening_height'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Left Opening Height Fraction</b>
            <select name="left_opening_height_fraction" id="left_opening_height_fraction" required <%= errors && errors.array().find(e => e.path === 'left_opening_height_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.left_opening_height_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'left_opening_height_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Middle Opening Height</b>
            <input type="text" name="middle_opening_height" id="middle_opening_height" value="<%= formData.middle_opening_height || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'middle_opening_height') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'middle_opening_height'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Middle Opening Height Fraction</b>
            <select name="middle_opening_height_fraction" id="middle_opening_height_fraction" required <%= errors && errors.array().find(e => e.path === 'middle_opening_height_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.middle_opening_height_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'middle_opening_height_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Right Opening Height</b>
            <input type="text" name="right_opening_height" id="right_opening_height" value="<%= formData.right_opening_height || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'right_opening_height') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'right_opening_height'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Right Opening Height Fraction</b>
            <select name="right_opening_height_fraction" id="right_opening_height_fraction" required <%= errors && errors.array().find(e => e.path === 'right_opening_height_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.right_opening_height_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'right_opening_height_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Top Level</b>
            <input type="text" name="top_level" id="top_level" value="<%= formData.top_level || '' %>" placeholder="Enter level measurement" required <%= errors && errors.array().find(e => e.path === 'top_level') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_level'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Bottom Level</b>
            <input type="text" name="bottom_level" id="bottom_level" value="<%= formData.bottom_level || '' %>" placeholder="Enter level measurement" required <%= errors && errors.array().find(e => e.path === 'bottom_level') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'bottom_level'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Left Plumb</b>
            <input type="text" name="left_plumb" id="left_plumb" value="<%= formData.left_plumb || '' %>" placeholder="Enter plumb measurement" required <%= errors && errors.array().find(e => e.path === 'left_plumb') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'left_plumb'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Right Plumb</b>
            <input type="text" name="right_plumb" id="right_plumb" value="<%= formData.right_plumb || '' %>" placeholder="Enter plumb measurement" required <%= errors && errors.array().find(e => e.path === 'right_plumb') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'right_plumb'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Starting Point</b>
            <input type="text" name="starting_point" id="starting_point" value="<%= formData.starting_point || '' %>" placeholder="Enter starting point" required <%= errors && errors.array().find(e => e.path === 'starting_point') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'starting_point'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <!-- Single or Dbl to be placed here (create a table for specifically the mirages)-->

        <label class="required-field"><b>Mount</b>
            <input type="text" name="mount" id="mount" value="<%= formData.mount || '' %>" placeholder="Enter mount type" required <%= errors && errors.array().find(e => e.path === 'mount') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'mount'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <!-- in Vs Surface -->

        <!-- handing to be placed here (create a table for specifically the mirages)-->

        <label class="required-field"><b>Color</b>
            <select  name="color_name" id="color" required <%= errors && errors.array().find(e => e.path === 'color_name') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% colors.forEach(color => { %>
                    <option value="<%= color.color_name %>" <%= formData.color_name === color.color_name ? 'selected' : '' %>><%= color.color_name %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'color_name') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

        <label class="required-field"><b>Handle</b>
            <!-- I assume this is actually the mirage_3500_handle column in the mirage3500 table -->
            <select  name="handle" id="handle" required <%= errors && errors.array().find(e => e.path === 'handle') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% handles.forEach(handle => { %>
                    <option value="<%= handle.mirage_3500_handle %>" <%= formData.handle === handle.mirage_3500_handle ? 'selected' : '' %>><%= handle.mirage_3500_handle %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'handle') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

        <label class="required-field"><b>Handle Color</b>
            <select  maxlength="10" name="handle_color" id="handle_color" required <%= errors && errors.array().find(e => e.path === 'handle_color') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% colors.forEach(color => { %>
                    <option value="<%= color.color_name %>" <%= formData.handle_color === color.color_name ? 'selected' : '' %>><%= color.color_name %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'handle_color') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

       <label class="required-field"><b>Top Adapter</b>
            <select name="top_adapter" id="top_adapter" required <%= errors && errors.array().find(e => e.path === 'top_adapter') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% topAdapters.forEach(adapter => { %>
                    <option value="<%= adapter.top_adapter_name %>" <%= formData.top_adapter === adapter.top_adapter_name ? 'selected' : '' %>><%= adapter.top_adapter_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_adapter'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Top Adapter Color</b>
            <select name="top_adapter_color" id="top_adapter_color" required <%= errors && errors.array().find(e => e.path === 'top_adapter_color') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% colors.forEach(color => { %>
                    <option value="<%= color.color_name %>" <%= formData.top_adapter_color === color.color_name ? 'selected' : '' %>><%= color.color_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_adapter_color'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

         <label class="required-field"><b>Top Adapter Width</b>
            <input type="text" name="top_adapter_width" id="top_adapter_width" value="<%= formData.top_adapter_width || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'top_adapter_width') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_adapter_width'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Top Adapter Width Fraction</b>
            <select name="top_adapter_width_fraction" id="top_adapter_width_fraction" required <%= errors && errors.array().find(e => e.path === 'top_adapter_width_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.top_adapter_width_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'top_adapter_width_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Unit Height</b>
            <input type="text" name="unit_height" id="unit_height" value="<%= formData.unit_height || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'unit_height') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'unit_height'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Unit Height Fraction</b>
            <select name="unit_height_fraction" id="unit_height_fraction" required <%= errors && errors.array().find(e => e.path === 'unit_height_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.unit_height_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'unit_height_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Pivot Pro Height</b>
            <input type="text" name="pivot_pro_height" id="pivot_pro_height" value="<%= formData.pivot_pro_height || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'pivot_pro_height') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'pivot_pro_height'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Pivot Pro Height Fraction</b>
            <select name="pivot_pro_height_fraction" id="pivot_pro_height_fraction" required <%= errors && errors.array().find(e => e.path === 'pivot_pro_height_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.pivot_pro_height_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'pivot_pro_height_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Bottom Adapter</b>
            <select name="btm_adapter" id="btm_adapter" required <%= errors && errors.array().find(e => e.path === 'btm_adapter') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% bottomAdapters.forEach(adapter => { %>
                    <option value="<%= adapter.bottom_adapter_name %>" <%= formData.btm_adapter === adapter.bottom_adapter_name ? 'selected' : '' %>><%= adapter.bottom_adapter_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'btm_adapter'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Bottom Adapter Color</b>
            <select name="btm_adapter_color" id="btm_adapter_color" required <%= errors && errors.array().find(e => e.path === 'btm_adapter_color') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% colors.forEach(color => { %>
                    <option value="<%= color.color_name %>" <%= formData.btm_adapter_color === color.color_name ? 'selected' : '' %>><%= color.color_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'btm_adapter_color'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Bottom Adapter Width</b>
            <input type="text" name="btm_adapter_width" id="btm_adapter_width" value="<%= formData.btm_adapter_width || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'btm_adapter_width') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'btm_adapter_width'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Bottom Adapter Width Fraction</b>
            <select name="btm_adapter_width_fraction" id="btm_adapter_width_fraction" required <%= errors && errors.array().find(e => e.path === 'btm_adapter_width_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.btm_adapter_width_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'btm_adapter_width_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Right Build Out</b>
            <select name="right_build_out" id="right_build_out" required <%= errors && errors.array().find(e => e.path === 'right_build_out') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% rightBuildouts.forEach(buildout => { %>
                    <option value="<%= buildout.right_buildout_name %>" <%= formData.right_build_out === buildout.right_buildout_name ? 'selected' : '' %>><%= buildout.right_buildout_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'right_build_out'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Left Build Out</b>
            <select name="left_build_out" id="left_build_out" required <%= errors && errors.array().find(e => e.path === 'left_build_out') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% leftBuildouts.forEach(buildout => { %>
                    <option value="<%= buildout.left_buildout_name %>" <%= formData.left_build_out === buildout.left_buildout_name ? 'selected' : '' %>><%= buildout.left_buildout_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'left_build_out'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

         <label class="required-field"><b>Build Out Dimension</b>
            <input type="text" name="build_out_dimension" id="build_out_dimension" value="<%= formData.build_out_dimension || '' %>" placeholder="Enter number (inches)" required <%= errors && errors.array().find(e => e.path === 'build_out_dimension') ? 'class="error-input"' : '' %>>
            <% if (errors) { const error = errors.array().find(e => e.path === 'build_out_dimension'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>
        <label class="required-field"><b>Build Out Dimension Fraction</b>
            <select name="build_out_dimension_fraction" id="build_out_dimension_fraction" required <%= errors && errors.array().find(e => e.path === 'build_out_dimension_fraction') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% fractions.forEach(fraction => { %>
                    <option value="<%= fraction.measurement_name %>" <%= formData.build_out_dimension_fraction === fraction.measurement_name ? 'selected' : '' %>><%= fraction.measurement_name %></option>
                <% }) %>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'build_out_dimension_fraction'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Mesh</b>
            <select name="mesh" id="mesh" required <%= errors && errors.array().find(e => e.path === 'mesh') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <% meshTypes.forEach(mesh => { %>
                    <option value="<%= mesh.mesh_type %>" <%= formData.mesh === mesh.mesh_type ? 'selected' : '' %>><%= mesh.mesh_type %></option>
                <% }) %>
            </select>
            <% if (errors) { %>
                <% const error = errors.array().find(e => e.path === 'mesh') %>
                <% if (error) { %>
                    <span class="error-message"><%= error.msg %></span>
                <% } %>
            <% } %>
        </label><br>

        <label class="required-field"><b>Mohair</b>
            <select name="mohair" id="mohair" required <%= errors && errors.array().find(e => e.path === 'mohair') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <option value=".200 MoHair X.187" <%= formData.mohair === '.200 MoHair X.187' ? 'selected' : '' %>>.200 MoHair X.187</option>
                <option value=".250 MoHair X.187" <%= formData.mohair === '.250 MoHair X.187' ? 'selected' : '' %>>.250 MoHair X.187</option>
                <option value=".300 MoHair X.187" <%= formData.mohair === '.300 MoHair X.187' ? 'selected' : '' %>>.300 MoHair X.187</option>
                <option value=".350 MoHair X.187" <%= formData.mohair === '.350 MoHair X.187' ? 'selected' : '' %>>.350 MoHair X.187</option>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'mohair'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <label class="required-field"><b>Mohair Position</b>
            <select name="mohair_position" id="mohair_position" required <%= errors && errors.array().find(e => e.path === 'mohair_position') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <option value="Edge" <%= formData.mohair_position === 'Edge' ? 'selected' : '' %>>Edge</option>
                <option value="Inside" <%= formData.mohair_position === 'Inside' ? 'selected' : '' %>>Inside</option>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'mohair_position'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

        <!-- bottom adapter screws have a fixed value for everything -->

        <label class="required-field"><b>Mohair Size</b>
            <select name="mohair_size" id="mohair_size" required <%= errors && errors.array().find(e => e.path === 'mohair_size') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <option value=".2" <%= formData.mohair_size === '.2' ? 'selected' : '' %>>.2</option>
                <option value=".25" <%= formData.mohair_size === '.25' ? 'selected' : '' %>>.25</option>
                <option value=".3" <%= formData.mohair_size === '.3' ? 'selected' : '' %>>.3</option>
                <option value=".35" <%= formData.mohair_size === '.35' ? 'selected' : '' %>>.35</option>
            </select>
            <% if (errors) { const error = errors.array().find(e => e.path === 'mohair_size'); if (error) { %><span class="error-message"><%= error.msg %></span><% }} %>
        </label><br>

         <!-- <label class="required-field"><b>Bumper Pads</b>
            <input type="text" name="bumper_pads" id="bumper_pads" value="<%#= formData.bumper_pads || '' %>" placeholder="Enter quantity or description" required <%#= errors && errors.array().find(e => e.path === 'bumper_pads') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'bumper_pads'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label class="required-field"><b>Silicone Spray</b>
            <input type="text" name="silicone_spray" id="silicone_spray" value="<%#= formData.silicone_spray || '' %>" placeholder="Enter quantity or description" required <%#= errors && errors.array().find(e => e.path === 'silicone_spray') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'silicone_spray'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label class="required-field"><b>WholeSale Price</b>
            <input type="text" name="wholesale_price" id="wholesale_price" value="<%#= formData.wholesale_price || '' %>" placeholder="Enter price (numbers only)" required <%#= errors && errors.array().find(e => e.path === 'wholesale_price') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'wholesale_price'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label class="required-field"><b>Markup Mutliplier</b>
            <select name="markup_multiplier" id="markup_multiplier" required <%#= errors && errors.array().find(e => e.path === 'markup_multiplier') ? 'class="error-input"' : '' %>>
                <option value="">Select</option>
                <option value="2" <%#= formData.markup_multiplier === '2' ? 'selected' : '' %>>2</option>
                <option value="1.9" <%#= formData.markup_multiplier === '1.9' ? 'selected' : '' %>>1.9</option>
                <option value="1.8" <%#= formData.markup_multiplier === '1.8' ? 'selected' : '' %>>1.8</option>
            </select>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'markup_multiplier'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label class="required-field"><b>Retail Price</b>
            <input type="text" name="retail_price" id="retail_price" value="<%#= formData.retail_price || '' %>" placeholder="Enter price (numbers only)" required <%#= errors && errors.array().find(e => e.path === 'retail_price') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'retail_price'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label class="required-field"><b>Custom Add-ons</b>
            <input type="text" name="custom_addons" id="custom_addons" value="<%#= formData.custom_addons || '' %>" placeholder="Enter custom add-ons description" required <%#= errors && errors.array().find(e => e.path === 'custom_addons') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'custom_addons'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label class="required-field"><b>PIA Obstacles Helper</b>
            <input type="text" name="pia_obstacles_helper" id="pia_obstacles_helper" value="<%#= formData.pia_obstacles_helper || '' %>" placeholder="Enter obstacles information" required <%#= errors && errors.array().find(e => e.path === 'pia_obstacles_helper') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'pia_obstacles_helper'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br>

        <label><b>Sold</b>
            <input type="checkbox" name="is_sold" id="is_sold" <%#= formData.is_sold ? 'checked' : '' %>>
        </label><br>

        <label><b>Date Sold</b>
            <input type="date" name="date_sold" id="date_sold" value="<%#= formData.date_sold || '' %>">
        </label><br>

        <label class="required-field"><b>QC Tech and Date</b>
            <input type="text" name="qc_tech_date" id="qc_tech_date" value="<%#= formData.qc_tech_date || '' %>" placeholder="Enter tech name and date" required <%#= errors && errors.array().find(e => e.path === 'qc_tech_date') ? 'class="error-input"' : '' %>>
            <%# if (errors) { const error = errors.array().find(e => e.path === 'qc_tech_date'); if (error) { %><span class="error-message"><%#= error.msg %></span><%# }} %>
        </label><br> -->


        <button class="formbtn" type="submit">Submit</button>

    </div>
</form>

<script>
    // Load form data from localStorage when page loads (only if no server-side data exists)
    window.addEventListener('DOMContentLoaded', function() {
        // Check if there's server-side form data (from validation errors or session)
        const hasServerData = "<%= Object.keys(formData || {}).length > 0 ? 'true' : 'false' %>";

        // Only load from localStorage if there's no server-side data
        if (!hasServerData) {
            const savedData = localStorage.getItem('mirage3500FormData');

            if (savedData) {
                try {
                    const formData = JSON.parse(savedData);

                    // Populate all form fields
                    for (const [key, value] of Object.entries(formData)) {
                        const field = document.querySelector(`[name="${key}"]`);

                        if (field) {
                            if (field.type === 'checkbox') {
                                field.checked = value === 'on' || value === true;
                            } else if (!field.value) {
                                // Only set value if field is currently empty
                                field.value = value;
                            }
                        }
                    }

                    console.log('Form data loaded from localStorage');
                } catch (e) {
                    console.error('Error loading form data:', e);
                }
            }
        }
    });

    // Save form data to localStorage when form is submitted
    document.getElementById('form').addEventListener('submit', function(event) {
        // Save form data before showing confirmation
        const formData = new FormData(this);
        const formObject = {};

        formData.forEach((value, key) => {
            formObject[key] = value;
        });

        localStorage.setItem('mirage3500FormData', JSON.stringify(formObject));
        console.log('Form data saved to localStorage');

        // Show confirmation popup
        const confirmed = confirm('Are you sure you want to submit this form? Please review all fields before proceeding.');
        if (!confirmed) {
            event.preventDefault(); // Prevent form submission if user clicks Cancel
        }
    });

    // Clear form button functionality
    document.getElementById('clearFormBtn').addEventListener('click', function() {
        const confirmed = confirm('Are you sure you want to clear all form data? This will reset the entire form and remove saved data.');
        if (confirmed) {
            // Clear localStorage
            localStorage.removeItem('mirage3500FormData');
            console.log('LocalStorage cleared');

            // Reset the form
            document.getElementById('form').reset();

            // Reload the page to ensure clean state
            window.location.reload();
        }
    });
</script>